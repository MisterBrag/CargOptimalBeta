<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles1.css') }}">
    <title>Pr√©diction des dimensions optimales</title>
    <style>
        #predict_result {
            border: 1px solid #000;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            background-color: #f0f0f0;
            display: none;
        }
    </style>
</head>
<body>
    <header>
    <h1> √âtape 4 : Pr√©dire les dimensions de la bo√Æte</h1>
    </header>

    <h3> Evaluation de la boite optimale pour le panier moyen de votre boutique </h3>
    <form id="predict_form" action="/predict_sa" method="post">
        <label for="num_products">Le panier moyen est compos√© de X produits :</label>
        <input type="number" id="num_products" name="num_products" min="1" required><br><br>
      
        <label for="file_box_dims">Fichier de dimensions de la bo√Æte : (optimal_box_dims_XXX)</label>
        <input type="file" id="file_box_dims" name="file_box_dims" required><br><br>
      
        <div id="product_dimensions"></div>
        <input type="submit" value="Pr√©dire">
        <br></br>
        <div id="predict_result">
            <h2>R√©sultats:</h2>
        <div id="result_content"></div>
    </div>
        <div id="loading_spinner_predict" style="display: none;">
        <img src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.16.1/images/loader-large.gif" alt="Chargement...">
        <span>Pr√©diction en cours...</span>
    </div>
</form>

    <a href="/optimisation" class="button btn btn-primary">Revenir √† l'√©tape pr√©c√©dente</a>
    <a href="/documentation" class="button btn btn-primary">Passer √† la documentation</a>

    <script>
    document.getElementById('num_products').addEventListener('input', function () {
    let numProducts = this.value;
    let container = document.getElementById('product_dimensions');
    container.innerHTML = '';

    for (let i = 1; i <= numProducts; i++) {
        let label = document.createElement('label');
        label.textContent = `Dimensions du produit ${i} (largeur x hauteur x profondeur) :`;
        container.appendChild(label);
        container.appendChild(document.createElement('br'));

        let inputWidth = document.createElement('input');
        inputWidth.type = 'number';
        inputWidth.name = `product_width_${i}`;
        inputWidth.step = '0.01';
        inputWidth.required = true;
        container.appendChild(inputWidth);

        let inputHeight = document.createElement('input');
        inputHeight.type = 'number';
        inputHeight.name = `product_height_${i}`;
        inputHeight.step = '0.01';
        inputHeight.required = true;
        container.appendChild(inputHeight);

        let inputDepth = document.createElement('input');
        inputDepth.type = 'number';
        inputDepth.name = `product_depth_${i}`;
        inputDepth.step = '0.01';
        inputDepth.required = true;
        container.appendChild(inputDepth);

        container.appendChild(document.createElement('br'));
        container.appendChild(document.createElement('br'));
    }
});

document.getElementById('predict_form').addEventListener('submit', function (event) {
    event.preventDefault();

    // Cr√©er un objet FormData pour collecter les donn√©es du formulaire
    const formData = new FormData(event.target);

    // Afficher l'indicateur de chargement
    document.getElementById('loading_spinner_predict').style.display = 'block';

    // Envoyer les donn√©es du formulaire via AJAX
    fetch('/predict_sa', {
    method: 'POST',
    body: formData
})
.then(response => response.json())
.then(result => {
    setTimeout(() => {
        document.getElementById('loading_spinner_predict').style.display = 'none';
        document.getElementById('predict_result').style.display = 'block';

        // Vous pouvez ajouter ici le code pour ins√©rer les r√©sultats dans des √©l√©ments HTML
        // Par exemple :
        const boxDims = result.box_dimensions;
        const forecast = result.forecast;
        const message = result.message;
        
        // Cr√©ez un format de texte pour afficher les r√©sultats de mani√®re lisible
        let resultText = `
    üì¶ Dimensions optimales de la bo√Æte pour 2 produit(s) : ${(boxDims.length).toFixed(1)} x ${(boxDims.width).toFixed(1)} x ${(boxDims.height).toFixed(1)}
    üí∞ Pour 100 colis envoy√©s, vous √©conomisez : ${forecast.savings} ‚Ç¨
    üå≥ Nombre d'arbres sauv√©s : ${forecast.trees_saved}
    üöÄ Bas√© sur les 250 colis que vous avez envoy√©s l'ann√©e derni√®re, et une pr√©vision de 450 colis cette ann√©e, vous pourriez √©conomiser jusqu'√† ${(forecast.forecasted_savings).toFixed(1)} ‚Ç¨ et sauver jusqu'√† ${(forecast.forecasted_trees_saved).toFixed(1)} arbres.
    Merci de contribuer √† un avenir plus durable ! üåçüíö
`;

        
        document.getElementById('result_content').innerText = resultText;
    }, 2000); 
})
    .catch(error => {
        // Masquer l'indicateur de chargement en cas d'erreur
        document.getElementById('loading_spinner_predict').style.display = 'none';
        
        console.error('Erreur lors de l\'envoi du formulaire:', error);
    });
});

    </script>
</body>
</html>

